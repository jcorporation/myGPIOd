# SPDX-License-Identifier: GPL-3.0-or-later
# myMPD (c) 2018-2022 Juergen Mang <mail@jcgames.de>
# https://github.com/jcorporation/mympd

#Install startup script
if(EXISTS "/lib/systemd/system" OR EXISTS "/usr/lib/systemd/system")
  file(INSTALL "@CMAKE_CURRENT_BINARY_DIR@/contrib/initscripts/mygpiod.service"
       DESTINATION "/usr/lib/systemd/system"
       FILE_PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)
elseif(EXISTS "/sbin/openrc-run")
  #Install openrc script
  file(RENAME "@CMAKE_CURRENT_BINARY_DIR@/contrib/initscripts/mygpiod.openrc"
              "@CMAKE_CURRENT_BINARY_DIR@/contrib/initscripts/mygpiod")
  file(INSTALL "@CMAKE_CURRENT_BINARY_DIR@/contrib/initscripts/mygpiod"
       DESTINATION "/etc/init.d"
       FILE_PERMISSIONS OWNER_WRITE OWNER_READ OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE)
elseif(EXISTS "/etc/init.d")
  #Install sysVinit script
  file(RENAME "@CMAKE_CURRENT_BINARY_DIR@/contrib/initscripts/mygpiod.sysVinit"
              "@CMAKE_CURRENT_BINARY_DIR@/contrib/initscripts/mygpiod")
  file(INSTALL "@CMAKE_CURRENT_BINARY_DIR@/contrib/initscripts/mygpiod"
       DESTINATION "/etc/init.d"
       FILE_PERMISSIONS OWNER_WRITE OWNER_READ OWNER_EXECUTE GROUP_READ GROUP_EXECUTE WORLD_READ WORLD_EXECUTE)
else()
  message("No supported init system found, no startup script was installed")
endif()

#Install mygpiod.conf
IF(NOT EXISTS "$ENV{DESTDIR}@CMAKE_INSTALL_FULL_SYSCONFDIR@/mygpiod.conf")
  MESSAGE("-- Installing: $ENV{DESTDIR}@CMAKE_INSTALL_FULL_SYSCONFDIR@/mygpiod.conf")
  file(INSTALL "@CMAKE_CURRENT_BINARY_DIR@/contrib/etc/mygpiod.conf"
       DESTINATION @CMAKE_INSTALL_FULL_SYSCONFDIR@
       FILE_PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)
ELSE()
  MESSAGE("-- Installing: $ENV{DESTDIR}@CMAKE_INSTALL_FULL_SYSCONFDIR@/mygpiod.conf.dist")
  file(RENAME "@CMAKE_CURRENT_BINARY_DIR@/contrib/etc/mygpiod.conf"
              "@CMAKE_CURRENT_BINARY_DIR@/contrib/etc/mygpiod.conf.dist")
  file(INSTALL "@CMAKE_CURRENT_BINARY_DIR@/contrib/etc/mygpiod.conf.dist"
       DESTINATION @CMAKE_INSTALL_FULL_SYSCONFDIR@
       FILE_PERMISSIONS OWNER_WRITE OWNER_READ GROUP_READ WORLD_READ)
ENDIF()
